<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أذكار المسلم (نسخة للمعاينة)</title>
    <style>
        :root {
            --bg-morning: linear-gradient(135deg, #89CFF0 0%, #B6E2F3 100%);
            --bg-evening: linear-gradient(135deg, #2C3E50 0%, #4A6E8A 100%);
            --bg-sleep: linear-gradient(135deg, #1C2833 0%, #34495E 100%);
            --bg-baqiyat: linear-gradient(135deg, #005C97 0%, #363795 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-hover-bg: rgba(255, 255, 255, 0.15);
            --card-completed-bg: rgba(46, 204, 113, 0.2);
            --text-color: #FFFFFF;
            --btn-bg: rgba(255, 255, 255, 0.2);
            --btn-active-border: #FFFFFF;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.8;
            transition: background 0.5s ease;
            min-height: 100vh;
            color: var(--text-color);
            font-size: 16px;
        }
        .morning { background: var(--bg-morning); }
        .evening { background: var(--bg-evening); }
        .sleep { background: var(--bg-sleep); }
        .baqiyat { background: var(--bg-baqiyat); }

        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        .header { text-align: center; margin-bottom: 20px; background: var(--card-bg); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); }
        .header h1 { font-size: 2em; margin-bottom: 15px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s ease; background: var(--btn-bg); color: var(--text-color); border: 2px solid transparent; }
        .btn:hover { transform: translateY(-2px); }
        .btn.active { border-color: var(--btn-active-border); }
        
        .dhikr-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .dhikr-grid { grid-template-columns: repeat(2, 1fr); } }

        .dhikr-card { background: var(--card-bg); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; }
        .dhikr-card:hover { transform: translateY(-5px); background: var(--card-hover-bg); }
        .dhikr-card.completed { background: var(--card-completed-bg); opacity: 0.7; }
        
        .dhikr-text { font-size: 1.1rem; text-align: center; margin-bottom: 15px; pointer-events: none; flex-grow: 1; white-space: pre-wrap; }
        .dhikr-source { font-size: 0.9rem; opacity: 0.8; text-align: center; margin-bottom: 15px; font-style: italic; pointer-events: none; }
        .dhikr-counter-display { font-size: 1rem; font-weight: bold; padding: 8px 15px; background: rgba(0, 0, 0, 0.2); border-radius: 20px; text-align: center; margin-top: 15px; pointer-events: none; }
        
        .reset-container { text-align: center; margin: 25px 0; }
        .reset-btn { background: rgba(255, 82, 82, 0.7); border: none; color: white; padding: 12px 28px; font-size: 1rem; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; }
        .reset-btn:hover { background: rgba(255, 82, 82, 1); transform: translateY(-2px); }
        
        .reminder-section { background: var(--card-bg); padding: 20px; border-radius: 15px; margin-top: 20px; text-align: center; }
        .reminder-section h2 { margin-bottom: 15px; font-size: 1.2rem; }
        .reminder-controls { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
        #reminder-time { padding: 10px; border-radius: 10px; border: 1px solid #FFF; background: rgba(0,0,0,0.2); color: white; }
        #save-reminder-btn, #cancel-reminder-btn { font-size: 14px; }
        #save-reminder-btn { background: #27ae60; }
        #cancel-reminder-btn { background: #c0392b; }
        #reminder-status { margin-top: 15px; font-size: 0.9rem; font-style: italic; }

        .footer-prayer { text-align: center; margin-top: 30px; padding: 15px; background: rgba(0, 0, 0, 0.1); border-radius: 10px; font-style: italic; font-size: 0.9rem; }
        .hidden { display: none; }
    </style>
</head>
<body class="morning">
    <div class="container">
        <div class="header">
            <h1 id="main-title">أذكار الصباح</h1>
            <div class="controls">
                <button class="btn active" onclick="showSection('morning', this)">أذكار الصباح</button>
                <button class="btn" onclick="showSection('evening', this)">أذكار المساء</button>
                <button class="btn" onclick="showSection('sleep', this)">أذكار النوم</button>
                <button class="btn" onclick="showSection('baqiyat', this)">الباقيات الصالحات</button>
            </div>
        </div>

        <div id="dhikr-container" class="dhikr-grid">
            <!-- Dhikr cards will be loaded here -->
        </div>

        <div class="reset-container">
            <button class="reset-btn" id="reset-all-btn">🔄 إعادة ضبط العدادات</button>
        </div>

        <div class="reminder-section">
            <h2>ضبط التذكير اليومي</h2>
            <div class="reminder-controls">
                <input type="time" id="reminder-time" class="btn">
                <button id="save-reminder-btn" class="btn">حفظ التذكير</button>
                <button id="cancel-reminder-btn" class="btn">إلغاء</button>
            </div>
            <p id="reminder-status"></p>
        </div>

        <div class="footer-prayer">
            <p>اللهم اجعل هذا العمل خالصًا لوجهك الكريم وأنفع به المسلمين في كل مكان</p>
        </div>
    </div>

    <script>
        const dhikrData = {
            morning: [
                { text: "أَعُوذُ بِاللهِ مِنْ الشَّيْطَانِ الرَّجِيمِ\nاللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ...", source: "آية الكرسي", count: 1 },
                { text: "سورة الإخلاص", source: "3 مرات", count: 3 },
                { text: "سورة الفلق", source: "3 مرات", count: 3 },
                { text: "سورة الناس", source: "3 مرات", count: 3 },
                { text: "أَصْـبَحْنا وَأَصْـبَحَ المُـلْكُ لله...", source: "مرة واحدة", count: 1 },
                { text: "اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ...", source: "سيد الاستغفار", count: 1 },
                { text: "رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ إِنِّـي أَصْبَـحْتُ أُشْـهِدُك...", source: "4 مرات", count: 4 },
                { text: "اللّهُـمَّ ما أَصْبَـَحَ بي مِـنْ نِعْـمَةٍ...", source: "مرة واحدة", count: 1 },
                { text: "حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ...", source: "7 مرات", count: 7 },
                { text: "بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ بِكَ أَصْـبَحْنا وَبِكَ أَمْسَـينا...", source: "مرة واحدة", count: 1 },
                { text: "أَصْبَـحْـنا عَلَى فِطْرَةِ الإسْلاَمِ...", source: "مرة واحدة", count: 1 },
                { text: "سُبْحـانَ اللهِ وَبِحَمْـدِهِ: عَدَدَ خَلْـقِه...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ عافِـني في بَدَنـي...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ...", source: "مرة واحدة", count: 1 },
                { text: "يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ...", source: "مرة واحدة", count: 1 },
                { text: "أَصْبَـحْـنا وَأَصْبَـحْ المُـلكُ للهِ رَبِّ العـالَمـين...", source: "مرة واحدة", count: 1 },
                { text: "اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ...", source: "مرة واحدة", count: 1 },
                { text: "أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ...", source: "3 مرات", count: 3 },
                { text: "اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على نَبِيِّنَا مُحمَّد", source: "10 مرات", count: 10 },
                { text: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ...", source: "مرة واحدة", count: 1 },
                { text: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا...", source: "مرة واحدة", count: 1 },
                { text: "أستغفر الله العظيم وأتوب إليه", source: "100 مرة", count: 100 },
                { text: "لا إله إلا الله وحده لا شريك له...", source: "100 مرة", count: 100 },
                { text: "سبحان الله وبحمده", source: "100 مرة", count: 100 }
            ],
            evening: [
                { text: "آية الكرسي", source: "مرة واحدة", count: 1 },
                { text: "سورة الإخلاص", source: "3 مرات", count: 3 },
                { text: "سورة الفلق", source: "3 مرات", count: 3 },
                { text: "سورة الناس", source: "3 مرات", count: 3 },
                { text: "أَمْسَيْـنا وَأَمْسـى المُـلْكُ لله...", source: "مرة واحدة", count: 1 },
                { text: "سيد الاستغفار", source: "مرة واحدة", count: 1 },
                { text: "رَضيـتُ بِاللهِ رَبَّـاً...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ إِنِّـي أَمسيْتُ أُشْـهِدُك...", source: "4 مرات", count: 4 },
                { text: "اللّهُـمَّ ما أَمْسَى بي مِـنْ نِعْـمَةٍ...", source: "مرة واحدة", count: 1 },
                { text: "حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ...", source: "7 مرات", count: 7 },
                { text: "بِسـمِ اللهِ الذي لا يَضُـرُّ...", source: "3 مرات", count: 3 },
                { text: "اللّهُـмَّ بِكَ أَمْسَيْـنا...", source: "مرة واحدة", count: 1 },
                { text: "أَمْسَيْـنا عَلَى فِطْرَةِ الإسْلاَمِ...", source: "مرة واحدة", count: 1 },
                { text: "سُبْحـانَ اللهِ وَبِحَمْـدِهِ: عَدَدَ خَلْـقِه...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ عافِـني في بَدَنـي...", source: "3 مرات", count: 3 },
                { text: "اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ...", source: "مرة واحدة", count: 1 },
                { text: "يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ...", source: "مرة واحدة", count: 1 },
                { text: "أَمْسَيْـنا وَأَمْسَى المُـلكُ للهِ...", source: "مرة واحدة", count: 1 },
                { text: "اللّهُـمَّ عالِـمَ الغَـيْبِ...", source: "مرة واحدة", count: 1 },
                { text: "أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ...", source: "3 مرات", count: 3 },
                { text: "اللَّهُمَّ صَلِّ وَسَلِّمْ...", source: "10 مرات", count: 10 },
                { text: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ...", source: "مرة واحدة", count: 1 },
                { text: "أستغفر الله العظيم وأتوب إليه", source: "100 مرة", count: 100 },
                { text: "لا إله إلا الله وحده لا شريك له...", source: "100 مرة", count: 100 },
                { text: "سبحان الله وبحمده", source: "100 مرة", count: 100 }
            ],
            sleep: [
                { text: "بِاسْـمِكَ اللّهُـمَّ أَمـوتُ وَأَحْـيا", source: "مرة واحدة", count: 1 },
                { text: "الإخلاص والمعوذتين", source: "3 مرات", count: 3 },
                { text: "آيَةُ الكُرْسِيِّ", source: "مرة واحدة", count: 1 },
                { text: "بِاسْـمِكَ رَبِّـي وَضَعْـتُ جَنْـبي...", source: "مرة واحدة", count: 1 },
                { text: "اللّهُـمَّ قِنـي عَذابَـكَ...", source: "3 مرات", count: 3 },
                { text: "الـحَمْـدُ للهِ الَّذِي أَطْـعَمَـنا...", source: "مرة واحدة", count: 1 },
                { text: "اللّهُـمَّ أَسْـلَمْتُ نَفْـسي إِلَـيْكَ...", source: "مرة واحدة", count: 1 },
                { text: "سبحان الله", source: "33 مرة", count: 33 },
                { text: "الحمد لله", source: "33 مرة", count: 33 },
                { text: "الله أكبر", source: "34 مرة", count: 34 }
            ],
            baqiyat: [
                { text: "سبحان الله", source: "الباقيات الصالحات", count: 100 },
                { text: "الحمد لله", source: "الباقيات الصالحات", count: 100 },
                { text: "لا إله إلا الله", source: "الباقيات الصالحات", count: 100 },
                { text: "الله أكبر", source: "الباقيات الصالحات", count: 100 },
                { text: "لا حول ولا قوة إلا بالله", source: "كنز من كنوز الجنة", count: 100 }
            ]
        };

        let currentMode = 'morning';
        let reminderTimeout = null;

        function initializeDhikrData() {
            Object.keys(dhikrData).forEach(mode => {
                dhikrData[mode].forEach(dhikr => {
                    dhikr.currentCount = 0;
                    dhikr.completed = false;
                });
            });
        }

        function saveProgress() {
            const progress = {};
            Object.keys(dhikrData).forEach(mode => {
                progress[mode] = dhikrData[mode].map(d => ({ currentCount: d.currentCount, completed: d.completed }));
            });
            localStorage.setItem('dhikrProgress_v4', JSON.stringify(progress));
        }

        function loadProgress() {
            const savedProgress = localStorage.getItem('dhikrProgress_v4');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                Object.keys(progress).forEach(mode => {
                    if (dhikrData[mode]) {
                        progress[mode].forEach((item, index) => {
                            if (dhikrData[mode][index]) {
                                dhikrData[mode][index].currentCount = item.currentCount || 0;
                                dhikrData[mode][index].completed = item.completed || false;
                            }
                        });
                    }
                });
            }
        }

        function createDhikrCard(dhikr, index) {
            const card = document.createElement('div');
            card.className = `dhikr-card ${dhikr.completed ? 'completed' : ''}`;
            card.dataset.index = index;
            card.innerHTML = `
                <p class="dhikr-text">${dhikr.text}</p>
                <p class="dhikr-source">${dhikr.source}</p>
                <div class="dhikr-counter-display">${dhikr.currentCount}/${dhikr.count}</div>
            `;
            card.addEventListener('click', () => handleCardClick(index));
            return card;
        }

        function displayDhikr() {
            const container = document.getElementById('dhikr-container');
            container.innerHTML = '';
            dhikrData[currentMode].forEach((dhikr, index) => {
                container.appendChild(createDhikrCard(dhikr, index));
            });
        }

        function handleCardClick(index) {
            const dhikr = dhikrData[currentMode][index];
            if (dhikr.completed) return;

            dhikr.currentCount++;
            if (dhikr.currentCount >= dhikr.count) {
                dhikr.completed = true;
            }
            
            saveProgress();
            updateCard(index);
        }

        function updateCard(index) {
            const card = document.querySelector(`.dhikr-card[data-index='${index}']`);
            if (card) {
                const dhikr = dhikrData[currentMode][index];
                card.querySelector('.dhikr-counter-display').textContent = `${dhikr.currentCount}/${dhikr.count}`;
                if (dhikr.completed) {
                    card.classList.add('completed');
                }
            }
        }

        window.showSection = function(mode, clickedButton) {
            currentMode = mode;
            document.body.className = mode;
            
            const titles = {
                morning: 'أذكار الصباح', evening: 'أذكار المساء',
                sleep: 'أذكار النوم', baqiyat: 'الباقيات الصالحات'
            };
            document.getElementById('main-title').textContent = titles[mode];

            const buttons = document.querySelectorAll('.controls .btn');
            buttons.forEach(button => button.classList.remove('active'));
            clickedButton.classList.add('active');
            
            displayDhikr();
        }

        document.getElementById('reset-all-btn').addEventListener('click', () => {
            dhikrData[currentMode].forEach(dhikr => {
                dhikr.currentCount = 0;
                dhikr.completed = false;
            });
            saveProgress();
            displayDhikr();
        });

        // Reminder Logic
        const reminderTimeInput = document.getElementById('reminder-time');
        const saveReminderBtn = document.getElementById('save-reminder-btn');
        const cancelReminderBtn = document.getElementById('cancel-reminder-btn');
        const reminderStatus = document.getElementById('reminder-status');

        function scheduleReminder(time) {
            if (reminderTimeout) clearTimeout(reminderTimeout);
            
            const [hours, minutes] = time.split(':');
            const now = new Date();
            let reminderDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0, 0);

            if (reminderDate < now) {
                reminderDate.setDate(reminderDate.getDate() + 1);
            }

            const timeToReminder = reminderDate.getTime() - now.getTime();

            reminderTimeout = setTimeout(() => {
                new Notification('تذكير الأذكار', {
                    body: 'حان وقت قراءة الأذكار اليومية. افتح الموقع الآن.',
                    icon: 'https://azizq8aa.github.io/dhikr-github-pages/favicon.ico' 
                });
                scheduleReminder(time); 
            }, timeToReminder);

            localStorage.setItem('dhikrReminderTime', time);
            updateReminderStatus();
        }

        function updateReminderStatus() {
            const savedTime = localStorage.getItem('dhikrReminderTime');
            if (savedTime) {
                reminderStatus.textContent = `تم ضبط التذكير اليومي الساعة ${savedTime}.`;
                reminderTimeInput.value = savedTime;
            } else {
                reminderStatus.textContent = 'لا يوجد تذكير محفوظ حاليًا.';
            }
        }

        saveReminderBtn.addEventListener('click', () => {
            const time = reminderTimeInput.value;
            if (time) {
                if (Notification.permission === 'granted') {
                    scheduleReminder(time);
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            scheduleReminder(time);
                        } else {
                            alert('تم رفض إذن الإشعارات. لا يمكن حفظ التذكير.');
                        }
                    });
                } else {
                    alert('الإشعارات محظورة. يرجى تفعيلها من إعدادات المتصفح.');
                }
            } else {
                alert('يرجى اختيار وقت للتذكير أولاً.');
            }
        });

        cancelReminderBtn.addEventListener('click', () => {
            if (reminderTimeout) clearTimeout(reminderTimeout);
            localStorage.removeItem('dhikrReminderTime');
            reminderTimeInput.value = '';
            updateReminderStatus();
            alert('تم إلغاء التذكير المحفوظ.');
        });

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            initializeDhikrData();
            loadProgress();
            displayDhikr();
            updateReminderStatus();
            
            const savedTime = localStorage.getItem('dhikrReminderTime');
            if (savedTime && Notification.permission === 'granted') {
                scheduleReminder(savedTime);
            }
        });
    </script>
</body>
</html>
